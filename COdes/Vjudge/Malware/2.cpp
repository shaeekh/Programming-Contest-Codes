#include<bits/stdc++.h>
using namespace std;
int main()
{
    int t;
    cin>>t;
    for (int i=1;i<=t;i++)
    {
        printf("Case %d:\n",i);
        list<char> lis;
        int n,m;
        cin>>n>>m;
        int count=0;

        for (int j=1;j<=m;j++)
        {



            string s;
            //int d;
            getline(cin,s);
           int d=(s.size())-1;
          // cout<<s[d]<<endl;
           /*if(s[1]=='u')
           {
               cin>>d;
           }
           */
            //cout<<s[1];
            if(s[1]=='u')
            {
                if(s[4]=='L')
                {
                    count++;
                    if(count<=n)
                    {lis.push_front(s[d]);
                    printf("Pushed in left: %c\n",s[d]);
                    //count++;
                    }

                }

                else if (s[4]=='R' )
                {
                    count++;
                    if(count<=n)
                    {
                        lis.push_back(s[d]);
                        printf("Pushed in right: %c\n",s[d]);
                        //count++;
                    //print korte hobe
                }
            }
            }

            else if(s[1]=='o')
            {
                if(s[3]=='L')
                {
                    lis.pop_front();
                    printf("Popped from left: %c\n",lis.back());
                    count--;
                }
                else if(s[3]=='R')
                    {
                        lis.pop_back();
                        //print
                        printf("Popped from right: %c\n",lis.front());
                        count--;
                  }

        }
        // cout<<lis.front()<<endl;
        if(count==n+1)
            {
                //count=0;

                printf("The queue is full\n");
            }
         if(lis.empty() && j>1)
               printf("The queue is empty\n");
    }
}
}


